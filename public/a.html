<div class="md-contents article-content__body my-2 flex-fill">
    <h3 id="_mo-dau-0">M·ªü ƒë·∫ßu</h3>

    <p>Khi b·∫°n vi·∫øt end-to-end tests, Laravel cung c·∫•p m·ªôt t·∫≠p h·ª£p c&aacute;c ph∆∞∆°ng th·ª©c h·ªØu &iacute;ch gi&uacute;p b·∫°n d·ªÖ d&agrave;ng nh·∫•p v&agrave;o m·ªôt li&ecirc;n k·∫øt, ƒëi·ªÅn form, hay submit m·ªôt form...Laravel s·ª≠ d·ª•ng th&agrave;nh ph·∫ßn Symfony BrowserKit ƒë·ªÉ m&ocirc; ph·ªèng ho·∫°t ƒë·ªông c·ªßa tr&igrave;nh duy·ªát web. Tuy nhi&ecirc;n, n·∫øu ·ª©ng d·ª•ng c·ªßa b·∫°n s·ª≠ d·ª•ng Javascript v&agrave; AJAX ƒë·ªÉ load trang th&igrave; BrowserKit s·∫Ω b&oacute; tay. V&agrave; Dusk s·∫Ω gi·∫£i quy·∫øt v·∫•n ƒë·ªÅ tr&ecirc;n, nh·∫±m gi·∫£ l·∫≠p c&aacute;c thao t&aacute;c nh∆∞ click, ƒëi·ªÅn form, th·∫≠m ch&iacute; l&agrave; k&eacute;o v&agrave; th·∫£ trong c&aacute;c ·ª©ng d·ª•ng d&ugrave;ng Javascript. C&oacute; ƒë∆∞·ª£c ƒëi·ªÅu n&agrave;y l&agrave; do Dusk s·ª≠ d·ª•ng ChromeDriver v&agrave; Facebook Php-webdriver. Khi b·∫°n vi·∫øt application tests, Dusk g·ª≠i c&aacute;c l·ªánh c·ªßa b·∫°n t·ªõi ChromeDriver, sau ƒë&oacute; tr&ecirc;n Chorme ch·∫°y c&aacute;c tests c·ªßa b·∫°n tr&ecirc;n tr&igrave;nh duy·ªát v&agrave; b&aacute;o c&aacute;o l·∫°i k·∫øt qu·∫£ (t·ª± ƒë·ªông ch·ª•p v&agrave; l∆∞u screenshot ·ª©ng d·ª•ng khi ch·∫°y test b·ªã fail).</p>

    <h3 id="_cai-dat-1">C&agrave;i ƒë·∫∑t</h3>

    <p>C&agrave;i ƒë·∫∑t Laravel Dusk b·∫±ng composer nh∆∞ sau: <code>composer require laravel/dusk</code> Ti·∫øp theo, ch&uacute;ng ta c·∫ßn ƒëƒÉng k&yacute; DuskServiceProvider trong ·ª©ng d·ª•ng. C&oacute; th·ªÉ l&agrave;m b·∫±ng 2 c&aacute;ch nh∆∞ sau:</p>

    <ul>
        <li>C&aacute;ch 1: Include trong providers array trong file <code>config/app.php</code> : <code>Laravel\Dusk\DuskServiceProvider::class,</code> V·ªõi c&aacute;ch n&agrave;y, DuskServiceProvider s·∫Ω ƒë∆∞·ª£c ƒëƒÉng k&yacute; trong ·ª©ng d·ª•ng cho t·∫•t c·∫£ c&aacute;c m&ocirc;i tr∆∞·ªùng.</li>
        <li>C&aacute;ch 2: ƒêƒÉng k&yacute; DuskServiceProvider trong AppServiceProvider class cho c&aacute;c m&ocirc;i tr∆∞·ªùng c·ª• th·ªÉ:</li>
    </ul>

    <pre class="prettyprint" data-filename="">
<code class="prettyprint">public function register()
   {
       if ($this-&gt;app-&gt;environment(&#39;local&#39;, &#39;testing&#39;, &#39;staging&#39;)) {
          $this-&gt;app-&gt;register(DuskServiceProvider::class);
       }
   }
</code></pre>

    <p>Cu·ªëi c&ugrave;ng, ho&agrave;n t·∫•t qu&aacute; tr&igrave;nh c&agrave;i ƒë·∫∑t: <code>php artisan dusk:install</code> <strong>Ch&uacute; &yacute;: th&ecirc;m APP_URL c·ªßa b·∫°n v&agrave;o file .env</strong> Khi ƒë&oacute;, m·ªôt file Browser ƒë∆∞·ª£c t·∫°o ra trong th∆∞ m·ª•c tests trong ·ª©ng d·ª•ng c·ªßa b·∫°n.</p>

    <h3 id="_our-first-test-2">Our First Test</h3>

    <p>T·∫°o m·ªôt Dusk test ƒë·∫ßu ti&ecirc;n <code>php artisan dusk:make LoginTest</code> L·ªánh tr&ecirc;n s·∫Ω t·∫°o m·ªôt LoginTst class trong th∆∞ m·ª•c Browser.</p>

    <pre class="prettyprint" data-filename="">
<code class="prettyprint">class LoginTest extends DuskTestCase
{
    /**
     * A Dusk test example.
     *
     * @return void
     */
    public function test_I_can_login_successfully()
    {
        $this-&gt;browse(function ($browser) {
            $browser-&gt;visit(&#39;/login&#39;)
                    -&gt;type(&#39;email&#39;, &#39;viraj@virajkhatavkar.com&#39;)
                    -&gt;type(&#39;password&#39;, &#39;secret&#39;)
                    -&gt;press(&#39;Login&#39;)
                    -&gt;assertSee(&#39;You are logged in!&#39;);
        });
    }
}
</code></pre>

    <p>Test case ·ªü tr&ecirc;n, cho ph&eacute;p ch&uacute;ng ta ki·ªÉm tra xem ng∆∞·ªùi d&ugrave;ng c&oacute; th·ªÉ ƒëƒÉng nh·∫≠p th&agrave;nh c&ocirc;ng v&agrave;o h·ªá th·ªëng hay kh&ocirc;ng v&agrave; xem tr&ecirc;n trang home v·ªõi th&ocirc;ng ƒëi·ªáp &#39;You are logged in!&#39; Ch&uacute; &yacute;: ƒê·ªÉ ki·ªÉm tra th&agrave;nh c&ocirc;ng ch&uacute;ng ta c·∫ßn m·ªôt ng∆∞·ªùi d&ugrave;ng th·ª±c trong c∆° s·ªü d·ªØ li·ªáu v·ªõi th&ocirc;ng tin t&agrave;i kho·∫£n nh∆∞ tr&ecirc;n. Ch·∫°y l·ªánh sau ƒë·ªÉ th·ª±c hi·ªán test: <code>php artisan dusk</code> N·∫øu trong database c·ªßa b·∫°n t·ªìn t·∫°i m·ªôt t&agrave;i kho·∫£n nh∆∞ tr&ecirc;n, khi ƒë&oacute; k·∫øt qu·∫£ nh∆∞ sau:</p>

    <pre class="prettyprint" data-filename="">
<code class="prettyprint">PHPUnit 5.7.6 by Sebastian Bergmann and contributors.

..                                                                  2 / 2 (100%)

Time: 4.71 seconds, Memory: 10.00MB

OK (2 tests, 2 assertions)
</code></pre>

    <h3 id="_failed-tests-3">Failed Tests</h3>

    <p>Gi·∫£ s·ª≠, ƒëƒÉng nh·∫≠p b·∫±ng t&agrave;i kho·∫£n kh&ocirc;ng t·ªìn t·∫°i trong h·ªá th·ªëng</p>

    <pre class="prettyprint" data-filename="">
<code class="prettyprint">public function test_I_can_login_successfully()
{
    $this-&gt;browse(function ($browser) {
        $browser-&gt;visit(&#39;/login&#39;)
                -&gt;type(&#39;email&#39;, &#39;viraj123@gmail.com&#39;)
                -&gt;type(&#39;password&#39;, &#39;secret&#39;)
                -&gt;press(&#39;Login&#39;)
                -&gt;assertSee(&#39;You are logged in!&#39;);
    });
}
</code></pre>

    <p>Khi ch·∫°y Dusk test k·∫øt qu·∫£ s·∫Ω nh∆∞ sau: <img alt="" class="medium-zoom-image" src="https://viblo.asia/uploads/b450db63-871d-4ae5-a55a-f9d66176f3c4.gif" /> Khi test l·ªói, th&igrave; Dusk s·∫Ω ch·ª•p m&agrave;n h&igrave;nh c·ªßa trang v&agrave; l∆∞u trong th∆∞ m·ª±c screenshots. <img alt="" class="medium-zoom-image" src="https://viblo.asia/uploads/f01de027-13c9-427e-809d-86c9490bf046.png" /> ƒêi·ªÉu n&agrave;y, cho ch&uacute;ng ta th·∫•y m·ªôt bi·ªÉu hi·ªán tr·ª±c quan l&yacute; do t·∫°i sao th·ª≠ nghi·ªám c·ªßa ch&uacute;ng ta kh&ocirc;ng th&agrave;nh c&ocirc;ng v&agrave; gi&uacute;p cho ch&uacute;ng ta c&oacute; th·ªÉ x&aacute;c ƒë·ªãnh nhanh ch&oacute;ng v·∫•n ƒë·ªÅ.</p>

    <h3 id="_testing-ajax-calls-4">Testing AJAX Calls</h3>

    <p>V&iacute; d·ª• demo: <img alt="" class="medium-zoom-image" src="https://viblo.asia/uploads/5a3616b8-b303-43c8-8a98-b558b136efbf.gif" /> Ch&uacute;ng ta s·ª≠ d·ª•ng AJAX ƒë&ecirc;t t·∫°o m·ªôt task m·ªõi, sau ƒë&oacute; ƒëi·ªÅu h∆∞·ªõng ng∆∞·ªùi d&ugrave;ng t·ªõi trang danh s&aacute;ch c&aacute;c task. <code>php artisan dusk:make CreateTaskTest</code> L&ecirc;nh tr&ecirc;n s·∫Ω t·∫°o ra m·ªôt CreateTaskTest class trong th∆∞ m·ª•c Browser, v&agrave; vi·∫øt test nh∆∞ sau:</p>

    <pre class="prettyprint" data-filename="">
<code class="prettyprint">public function test_I_can_create_task_successfully()
    {
        $this-&gt;browse(function ($browser) {

            $browser-&gt;visit(&#39;/tasks/create&#39;)
                    -&gt;type(&#39;title&#39;, &#39;My Task&#39;)
                    -&gt;press(&#39;Add Task&#39;)
                    -&gt;pause(5000)
                    -&gt;assertPathIs(&#39;/tasks&#39;);
        });
    }
</code></pre>

    <p>Sau ƒë&oacute; h&atilde;y ch·∫°y Dusk test v&agrave; xem k·∫øt qu·∫£: <img alt="" class="medium-zoom-image" src="https://viblo.asia/uploads/b472488c-6439-4b92-98f7-4a172fc35cab.gif" /> Nh∆∞ b·∫°n th·∫•y, testcase ƒë&atilde; th&agrave;nh c&ocirc;ng. Ngo&agrave;i ra, ch&uacute;ng ta c≈©ng c&oacute; th·ªÉ s·ª≠ d·ª•ng waitUntilMissing API c·ªßa Dusk ƒë·ªÉ test</p>

    <pre class="prettyprint" data-filename="">
<code class="prettyprint">public function test_I_can_create_task_successfully()
    {
        $this-&gt;browse(function ($browser) {

            $browser-&gt;visit(&#39;/tasks/create&#39;)
                    -&gt;type(&#39;title&#39;, &#39;My Task&#39;)
                    -&gt;press(&#39;Add Task&#39;)
                    -&gt;waitUntilMissing(&#39;.btn-primary&#39;)
                    -&gt;assertPathIs(&#39;/tasks&#39;);
        });
    }

</code></pre>

    <p>B·∫°n c&oacute; th·ªÉ tham kh·∫£o t&agrave;i li·ªáu ƒë·ªÉ t&igrave;m hi·ªÉu v·ªÅ c&aacute;c y·∫øu t·ªë ch·ªù ƒë·ª£i kh&aacute;c c&oacute; s·∫µn trong API.</p>

    <h3 id="_pages-5">Pages</h3>

    <p>Ch&uacute;ng ta s·ª≠ d·ª•ng Pages ƒë·ªÉ t·∫°o l·∫°i CreateTaskPage nh∆∞ sau: <code>php artisan dusk:page CreateTaskPage</code> L&ecirc;nh tr&ecirc;n s·∫Ω t·∫°o m·ªôt CreateTaskPage trong th∆∞ m·ª•c Pages.</p>

    <pre class="prettyprint" data-filename="">
<code class="prettyprint">public function url()
{
    return &#39;/tasks/create&#39;;
}
</code></pre>

    <p>B·∫•t c·ª© khi n&agrave;o trang n&agrave;y ƒë∆∞·ª£c g·ªçi, Dusk s·∫Ω ƒëi·ªÅu h∆∞·ªõng ƒë·∫øn url n&agrave;y.</p>

    <pre class="prettyprint" data-filename="">
<code class="prettyprint">public function assert(Browser $browser)
{
    $browser-&gt;assertPathIs($this-&gt;url());
}
</code></pre>

    <p>Trong v&iacute; d·ª• tr&ecirc;n, t&ocirc;i ch·ªâ ƒë∆°n gi·∫£n kh·∫≥ng ƒë·ªãnh r·∫±ng url c·ªßa trang ƒëang ho·∫°t ƒë·ªông l&agrave; th&iacute;ch h·ª£p.</p>

    <pre class="prettyprint" data-filename="">
<code class="prettyprint">public function elements()
{
    return [
        &#39;@addTask&#39; =&gt; &#39;.btn-primary&#39;,
    ];
}
</code></pre>

    <p>C&aacute;c elements method c&oacute; th·ªÉ c&oacute; b·ªô ch·ªçn s·∫µn ƒë∆∞·ª£c x&aacute;c ƒë·ªãnh tr∆∞·ªõc. Ch&uacute;ng ta c&oacute; th·ªÉ x&aacute;c ƒë·ªãnh t&ecirc;n ng∆∞·ªùi d&ugrave;ng c&oacute; th·ªÉ ƒë·ªçc ƒë∆∞·ª£c cho b·ªô ch·ªçn v&agrave; s·ª≠ d·ª•ng l·∫°i ch&uacute;ng cho trang n&agrave;y trong c&aacute;c tr∆∞·ªùng h·ª£p th·ª≠ nghi·ªám kh&aacute;c nhau. Trong v&iacute; d·ª• tr&ecirc;n, t&ocirc;i ƒë&atilde; x&aacute;c ƒë·ªãnh m·ªôt n&uacute;t ch·ªçn cho n&uacute;t <strong>addTask</strong> B&acirc;y gi·ªù ch&uacute;ng ta h&atilde;y s·ª≠a ƒë·ªïi CreateTaskTest class v&agrave; s·ª≠ d·ª•ng b·ªô ch·ªçn:</p>

    <pre class="prettyprint" data-filename="">
<code class="prettyprint">public function test_I_can_create_task_successfully()
    {
        $this-&gt;browse(function ($browser) {

            $user = factory(User::class)-&gt;create();

            $browser-&gt;loginAs($user)
                    -&gt;visit(new CreateTaskPage)
                    -&gt;type(&#39;title&#39;, &#39;My Task&#39;)
                    -&gt;click(&#39;@addTask&#39;)
                    -&gt;waitUntilMissing(&#39;@addTask&#39;)
                    -&gt;assertPathIs(&#39;/tasks&#39;);
        });
    }
</code></pre>

    <p>Gi·ªù th&igrave; ch·ªâ c·∫ßn ch·∫°y Dusk test v&agrave; k·∫øt qu·∫£ nh∆∞ sau:</p>

    <pre class="prettyprint" data-filename="">
<code class="prettyprint">PHPUnit 5.7.13 by Sebastian Bergmann and contributors.

.                                                                   1 / 1 (100%)

Time: 2.76 seconds, Memory: 12.00MB

OK (1 test, 2 assertions)
</code></pre>

    <p>B·∫°n th·∫≠m ch&iacute; c&oacute; th·ªÉ x&aacute;c ƒë·ªãnh c&aacute;c ph∆∞∆°ng ph&aacute;p t&ugrave;y ch·ªânh ƒë·ªÉ th·ª±c hi·ªán m·ªôt s·ªë h&agrave;nh ƒë·ªông t&aacute;i s·ª≠ d·ª•ng tr&ecirc;n m·ªôt trang nh·∫•t ƒë·ªãnh. B·∫°n c&oacute; th·ªÉ ƒë·ªçc th&ecirc;m v·ªÅ n&oacute; trong <a href="https://laravel.com/docs/5.4/dusk#pages" target="_blank">t&agrave;i li·ªáu</a></p>

    <h3 id="_ket-luan-6">K·∫øt Lu·∫≠n</h3>

    <p>Trong b&agrave;i vi·∫øt n&agrave;y, t&ocirc;i ƒë&atilde; gi·ªõi thi·ªáu v·ªÅ Laravel Dusk, c&aacute;ch c&agrave;i ƒë·∫∑t v&agrave; h∆∞·ªõng d·∫´n test m·ªôt s·ªë ch·ª©c nƒÉng c∆° b·∫£n. Sau khi t&igrave;m hi·ªÉu ph·∫ßn n&agrave;y m&igrave;nh th·∫•y n&oacute; th·ª±c s·ª± r·∫•t hay v&agrave; ƒë·ªÉ hi·ªÉu v·ªÅ n&oacute;, h&atilde;y th·ª≠ th·ª±c nghi·ªám nh&eacute; <img alt="üòÑ" class="emoji" draggable="false" src="https://twemoji.maxcdn.com/2/72x72/1f604.png" />. <strong>T&agrave;i li·ªáu tham kh·∫£o:</strong> <a href="https://laravel.com/docs/5.4/dusk" target="_blank">https://laravel.com/docs/5.4/dusk</a></p>
</div>
